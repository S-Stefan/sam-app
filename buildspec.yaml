version: 0.2

phases:
  install:
    runtime-versions: 
      python: 3.7
    comands:
      - echo "this is a test to see how far this goes."
      - pip install --upgrade pip
      - pip install aws-sam-cli

  build:
    commands:
      - echo build started at `date` for environment dev
      - sam build -t template.yaml
      - echo $CODEBUILD_SRC_DIR
      - sam package --s3-bucket codepipeline-eu-west-1-164630341625 --s3-prefix svr-test/BuildArti --kms-key-id $KMS_KEY_ID --template-file template.yaml --output-template-file svr-test-package.yaml --debug
      - echo "deploying"
      #- sam deploy --template-file svrtest-package.yaml --region eu-west-1 --capabilities CAPABILITY_IAM --stack-name sam-devops-deploy

artifacts:
  files:
    - '**/*'
  name: svr-test-package.yaml-$(date +%Y-%m-%d)
  discard-paths: yes
